SOURCES = $(wildcard *.c)
TESTS = $(basename $(SOURCES))

ifndef ARCHOS
   ARCHOS = @ARCHOS@
endif

CILLY = ../../obj/$(ARCHOS)/cilly.byte.exe

all: compare

big: cfrac

$(TESTS): %: %.c FORCE
	@mkdir -p temp
	$(CC) -E $< -o temp/$@.i
	$(CILLY) --dollvm temp/$@.i >temp/$@.ll
	llvm-as -f temp/$@.ll
	llc -f temp/$@.bc
	$(CC) -o temp/$@.llvm temp/$@.s
	temp/$@.llvm

compare:
	@sh compare-with-gcc $(CILLY)

cfrac:
	make -C cfrac.d ARCHOS=$(ARCHOS)

clean:
	rm -rf temp

FORCE:
.PHONY: FORCE big cfrac

