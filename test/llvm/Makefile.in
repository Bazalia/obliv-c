SOURCES = $(wildcard *.c)
TESTS = $(basename $(SOURCES))

ifndef ARCHOS
   ARCHOS = @ARCHOS@
endif

CILLY = ../../obj/$(ARCHOS)/cilly.byte.exe

all: compare

big: cfrac

$(TESTS): %: %.c FORCE
	@mkdir -p temp
	gcc -E $< -o temp/$@.i
	$(CILLY) --dollvm temp/$@.i >temp/$@.ll
	llvmc2 -o temp/$@.llvm temp/$@.ll
	temp/$@.llvm

compare:
	@sh compare-with-gcc $(CILLY)

cfrac:
	make -C cfrac.d ARCHOS=$(ARCHOS)

clean:
	rm -rf temp

FORCE:
.PHONY: FORCE big cfrac

